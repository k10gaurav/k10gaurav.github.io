<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WSO2 API Manager Shutdown Process</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a3a 0%, #0d1b2a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            border-bottom: 1px solid #2a3a4a;
        }
        
        h1 {
            color: #ff7300;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0a0;
        }
        
        .infographic {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
        }
        
        .step {
            background: linear-gradient(145deg, #2a3a4a 0%, #1a2a3a 100%);
            border-radius: 10px;
            padding: 25px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid #ff7300;
            position: relative;
            overflow: hidden;
        }
        
        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            border-left-width: 8px;
        }
        
        .step.active {
            background: linear-gradient(145deg, #3a4a5a 0%, #2a3a4a 100%);
            border-left-color: #4CAF50;
        }
        
        .step-number {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff7300;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .step-title {
            font-size: 1.4rem;
            color: #ff7300;
            margin-bottom: 10px;
        }
        
        .step-description {
            color: #c0c0c0;
            line-height: 1.5;
        }
        
        .connector {
            width: 4px;
            height: 30px;
            background: #ff7300;
            margin: 0 auto;
            position: relative;
        }
        
        .connector::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: -5px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ff7300;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        button {
            background: #ff7300;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background: #ff8c33;
            transform: translateY(-2px);
            box-shadow: 0 5px 8px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .progress-bar {
            width: 80%;
            max-width: 600px;
            height: 10px;
            background: #2a3a4a;
            border-radius: 5px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #ff7300, #4CAF50);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .details-panel {
            background: rgba(42, 58, 74, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin: 30px auto 0px auto;
            width: 80%;
            max-width: 600px;
            display: none;
        }
        
        .details-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .details-title {
            color: #ff7300;
            font-size: 1.3rem;
            margin-bottom: 15px;
            border-bottom: 1px solid #3a4a5a;
            padding-bottom: 10px;
        }
        
        .details-content {
            line-height: 1.6;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .step, .progress-bar, .details-panel {
                width: 95%;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>WSO2 API Manager Shutdown Process</h1>
            <p class="subtitle">Interactive visualization of the graceful shutdown sequence</p>
        </header>
        
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        
        <div class="infographic">
            <div class="step" data-step="1">
                <div class="step-number">1</div>
                <h3 class="step-title">Shutdown Triggered</h3>
                <p class="step-description">Shutdown initiated via Ctrl+C signal or stop script execution.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <h3 class="step-title">JVM Shutdown Hook</h3>
                <p class="step-description">JVM shutdown hook calls CarbonServer to begin graceful shutdown process.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <h3 class="step-title">Notify Lifecycle Listeners</h3>
                <p class="step-description">All registered lifecycle listeners are notified about the shutdown event.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <h3 class="step-title">Stop Transports</h3>
                <p class="step-description">HTTP/HTTPS and JMS transports are stopped to prevent new connections.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <h3 class="step-title">Handle Active Requests</h3>
                <p class="step-description">Existing requests are given time to complete processing before termination.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="6">
                <div class="step-number">6</div>
                <h3 class="step-title">Shutdown Axis2 Engine</h3>
                <p class="step-description">Axis2 engine is gracefully shut down, ensuring proper cleanup.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="7">
                <div class="step-number">7</div>
                <h3 class="step-title">Stop Synapse</h3>
                <p class="step-description">Synapse engine stops processing APIs and sequences.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="8">
                <div class="step-number">8</div>
                <h3 class="step-title">Close DB/Registry Connections</h3>
                <p class="step-description">Database and registry connections are properly closed and released.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="9">
                <div class="step-number">9</div>
                <h3 class="step-title">Shutdown OSGi Bundles</h3>
                <p class="step-description">All OSGi bundles are stopped in the correct dependency order.</p>
            </div>
            
            <div class="connector"></div>
            
            <div class="step" data-step="10">
                <div class="step-number">10</div>
                <h3 class="step-title">Shutdown Complete</h3>
                <p class="step-description">WSO2 API Manager has been completely shut down and all resources released.</p>
            </div>
        </div>
        
        <div class="details-panel" id="detailsPanel">
            <h3 class="details-title" id="detailsTitle">Step Details</h3>
            <div class="details-content" id="detailsContent">
                Click on any step to see detailed information about that phase of the shutdown process.
            </div>
        </div>
        
        <div class="controls">
            <button id="prevBtn">Previous Step</button>
            <button id="nextBtn">Next Step</button>
            <button id="resetBtn">Reset</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const steps = document.querySelectorAll('.step');
            const progress = document.getElementById('progress');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const resetBtn = document.getElementById('resetBtn');
            const detailsPanel = document.getElementById('detailsPanel');
            const detailsTitle = document.getElementById('detailsTitle');
            const detailsContent = document.getElementById('detailsContent');
            
            let currentStep = 0;
            const totalSteps = steps.length;
            
            // Step details data
            const stepDetails = {
                1: {
                    title: "Shutdown Triggered",
                    content: "The shutdown process begins when a termination signal is received. This can happen through:<br><br>" +
                             "• <strong>Ctrl+C</strong> in the terminal where WSO2 server is running<br>" +
                             "• Execution of the <strong>stop script</strong> (wso2server.sh stop)<br>" +
                             "• System shutdown or service manager stop command<br><br>" +
                             "At this point, the JVM begins its shutdown sequence and calls registered shutdown hooks."
                },
                2: {
                    title: "JVM Shutdown Hook",
                    content: "The Java Virtual Machine executes the registered shutdown hook for CarbonServer:<br><br>" +
                             "• JVM calls the <strong>CarbonServer.shutdown()</strong> method<br>" +
                             "• This initiates the graceful shutdown process<br>" +
                             "• The hook ensures proper cleanup even if the process is terminated forcefully<br><br>" +
                             "This mechanism allows WSO2 API Manager to clean up resources before the JVM exits completely."
                },
                3: {
                    title: "Notify Lifecycle Listeners",
                    content: "All components that have registered lifecycle listeners are notified about the impending shutdown:<br><br>" +
                             "• <strong>LifecycleManager</strong> broadcasts shutdown events<br>" +
                             "• Components can perform pre-shutdown tasks<br>" +
                             "• Custom shutdown logic in extensions is executed<br><br>" +
                             "This ensures that all parts of the system are aware of the shutdown and can prepare accordingly."
                },
                4: {
                    title: "Stop Transports",
                    content: "Network transports are shut down to prevent new incoming requests:<br><br>" +
                             "• <strong>HTTP/HTTPS</strong> listeners stop accepting new connections<br>" +
                             "• <strong>JMS</strong> message consumers are stopped<br>" +
                             "• <strong>Thrift</strong> and other transport listeners are closed<br><br>" +
                             "Existing connections are allowed to complete their current operations before being terminated."
                },
                5: {
                    title: "Handle Active Requests",
                    content: "Active requests in progress are given time to complete:<br><br>" +
                             "• A <strong>grace period</strong> is provided for in-flight requests<br>" +
                             "• Request timeouts are respected<br>" +
                             "• No new requests are accepted during this phase<br><br>" +
                             "This prevents data corruption and ensures that clients receive proper responses for their requests."
                },
                6: {
                    title: "Shutdown Axis2 Engine",
                    content: "The Axis2 engine, which handles SOAP and other web services, is shut down:<br><br>" +
                             "• Axis2 <strong>ConfigurationContext</strong> is cleaned up<br>" +
                             "• Service groups and services are properly undeployed<br>" +
                             "• Message receivers and senders are stopped<br><br>" +
                             "This ensures that all web service processing is gracefully terminated."
                },
                7: {
                    title: "Stop Synapse",
                    content: "The Synapse mediation engine, which processes APIs and sequences, is stopped:<br><br>" +
                             "• All <strong>APIs</strong> and <strong>proxy services</strong> are undeployed<br>" +
                             "• <strong>Sequences</strong> and <strong>endpoints</strong> are cleaned up<br>" +
                             "• Mediation flows are terminated<br><br>" +
                             "This step ensures that all API Gateway processing is properly shut down."
                },
                8: {
                    title: "Close DB/Registry Connections",
                    content: "Database and registry connections are properly closed:<br><br>" +
                             "• <strong>Database connections</strong> from connection pools are released<br>" +
                             "• <strong>Registry</strong> connections and sessions are closed<br>" +
                             "• Transaction resources are cleaned up<br><br>" +
                             "This prevents resource leaks and ensures data integrity in the registry and databases."
                },
                9: {
                    title: "Shutdown OSGi Bundles",
                    content: "All OSGi bundles are stopped in the correct dependency order:<br><br>" +
                             "• Bundles are stopped in <strong>reverse dependency order</strong><br>" +
                             "• <strong>Carbon kernel</strong> bundles are stopped last<br>" +
                             "• Bundle contexts and services are properly disposed<br><br>" +
                             "This orderly shutdown prevents issues when restarting the server."
                },
                10: {
                    title: "Shutdown Complete",
                    content: "The WSO2 API Manager shutdown process is complete:<br><br>" +
                             "• All resources have been released<br>" +
                             "• The JVM can now exit safely<br>" +
                             "• The server process terminates<br><br>" +
                             "The server is now fully stopped and can be safely restarted or the system shut down."
                }
            };
            
            // Initialize
            updateProgress();
            
            // Step click events
            steps.forEach(step => {
                step.addEventListener('click', function() {
                    const stepNum = parseInt(this.getAttribute('data-step'));
                    setCurrentStep(stepNum - 1);
                });
            });
            
            // Button events
            prevBtn.addEventListener('click', function() {
                if (currentStep > 0) {
                    setCurrentStep(currentStep - 1);
                }
            });
            
            nextBtn.addEventListener('click', function() {
                if (currentStep < totalSteps - 1) {
                    setCurrentStep(currentStep + 1);
                }
            });
            
            resetBtn.addEventListener('click', function() {
                setCurrentStep(0);
            });
            
            function setCurrentStep(stepIndex) {
                currentStep = stepIndex;
                
                // Update step visuals
                steps.forEach((step, index) => {
                    if (index === currentStep) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
                
                // Update progress bar
                updateProgress();
                
                // Update details panel
                updateDetailsPanel();
            }
            
            function updateProgress() {
                const progressPercent = (currentStep / (totalSteps - 1)) * 100;
                progress.style.width = `${progressPercent}%`;
            }
            
            function updateDetailsPanel() {
                const stepNum = currentStep + 1;
                detailsTitle.textContent = stepDetails[stepNum].title;
                detailsContent.innerHTML = stepDetails[stepNum].content;
                detailsPanel.classList.add('active');
            }
        });
    </script>
</body>
</html>
